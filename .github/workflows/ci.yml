name: CI/CD Pipeline (Disabled)

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  # Job 1: Build and Test SDK
  sdk-test:
    name: SDK Build & Test
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'pnpm'
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build SDK
        run: pnpm sdk:build
      
      - name: Run SDK tests
        run: pnpm sdk:test
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          files: ./packages/fhevm-sdk/coverage/coverage-final.json
          flags: sdk
          name: sdk-coverage

  # Job 2: Lint
  lint:
    name: Lint Code
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
      
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build SDK
        run: pnpm sdk:build
      
      - name: Lint Next.js
        run: pnpm next:lint
      
      - name: Lint Hardhat
        run: pnpm hardhat:lint

  # Job 3: Contract Tests
  contracts-test:
    name: Smart Contract Tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
      
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build SDK
        run: pnpm sdk:build
      
      - name: Compile contracts
        run: pnpm contracts:build
      
      - name: Run contract tests
        run: pnpm hardhat:test

  # Job 4: Build Next.js
  nextjs-build:
    name: Next.js Build
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
      
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build SDK
        run: pnpm sdk:build
      
      - name: Build Next.js app
        run: pnpm next:build
        env:
          NEXT_PUBLIC_ALCHEMY_API_KEY: ${{ secrets.ALCHEMY_API_KEY }}

  # Job 5: E2E Tests (with local chain)
  e2e-test:
    name: E2E Tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
      
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build SDK
        run: pnpm sdk:build
      
      - name: Start local chain
        run: pnpm chain &
      
      - name: Wait for chain
        run: sleep 10
      
      - name: Deploy contracts
        run: pnpm contracts:deploy
      
      - name: Run E2E tests
        run: pnpm test
      
      - name: Stop chain
        run: pkill -f hardhat || true

  # Job 6: Type Check
  type-check:
    name: TypeScript Type Check
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
      
      - name: Install pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: Install dependencies
        run: pnpm install
      
      - name: Build SDK
        run: pnpm sdk:build
      
      - name: Check types - Next.js
        run: pnpm next:check-types
      
      - name: Check types - Hardhat
        run: pnpm hardhat:check-types

  # Job 7: All checks passed
  all-checks:
    name: All Checks Passed âœ…
    runs-on: ubuntu-latest
    needs: [sdk-test, lint, contracts-test, nextjs-build, e2e-test, type-check]
    
    steps:
      - name: Success message
        run: |
          echo "ðŸŽ‰ All checks passed!"
          echo "âœ… SDK tests passed"
          echo "âœ… Linting passed"
          echo "âœ… Contract tests passed"
          echo "âœ… Next.js build passed"
          echo "âœ… E2E tests passed"
          echo "âœ… Type checks passed"
          echo ""
          echo "Ready to deploy! ðŸš€"

